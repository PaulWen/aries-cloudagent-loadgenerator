version: "3.7"
services:

  grafana:
    container_name: grafana
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      GF_RENDERING_SERVER_URL: http://grafana-image-renderer:8081/render
      GF_RENDERING_CALLBACK_URL: http://grafana:3000/
      GF_LOG_FILTERS: rendering:debug
    volumes:
      - grafana-volume:/var/lib/grafana
      - ./grafana/grafana-provisioning:/etc/grafana/provisioning
      - ./grafana/grafana.ini:/etc/grafana/grafana.ini
      - ./grafana/dashboards:/var/lib/grafana/dashboards
    networks:
      - aries-load-test

  # https://grafana.com/grafana/plugins/grafana-image-renderer/#installation
  grafana-image-renderer:
    container_name: grafana-image-renderer
    image: grafana/grafana-image-renderer:latest
    ports:
      - 8081
    networks:
      - aries-load-test

  # https://github.com/IzakMarais/reporter
  grafana-pdf-exporter:
    container_name: grafana-pdf-exporter
    image: izakmarais/grafana-reporter
    entrypoint: "/usr/local/bin/grafana-reporter -ip grafana:3000 -grid-layout=1"
    ports:
      - 8686:8686
    networks:
      - aries-load-test

  loki:
    container_name: loki
    image: grafana/loki:2.4.2
    ports:
      - 3100:3100
    command: -config.file=/etc/loki/local-config.yaml
    volumes:
      - loki-volume:/data/loki
      - ./loki/local-config.yaml:/etc/loki/local-config.yaml
    depends_on:
      - grafana
    networks:
      - aries-load-test

networks:
  aries-load-test:
    name: aries-load-test

volumes:
  grafana-volume:
  loki-volume:
